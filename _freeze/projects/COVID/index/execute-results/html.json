{
  "hash": "579979012348d2203d7a4fc397731fc7",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ndate: '2024-03-18'\ntitle: \"COVID Reflection\"\ncategories: [Paper, Python, Dataviz, COVID]\nimage: \"/assets/Iris_pca.png\"\ntitle-block-banner: false\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-tools: true\n    link-external-icon: true\n    link-external-newwindow: true\n---\n\n::: {#6711fba5 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nfrom forecast import optimize_fit, SIR \nimport matplotlib.pyplot as plt\nimport numpy as np\n```\n:::\n\n\n*Abstract Goes Here*\n\n## Introduction\n\nBack in 2020 on July 29th, I published a long term COVID prediction model based on a simple and well known Epidemiology model called SIR. The model makes long term predictions on what happens to a population when a new infectious disease is introduced. At the time of writing, this wasn't a popular model to pursue since it was harder to predict and prove short term COVID case counts. Now in 2025, I thought it would be interesting to see how good this kind of modeling was and how it could have been improved in hindsight.\n\n## Data\n\nThe following data represents counties with various population, mobility, and disease case numbers. The data is provided by multiple sources, including John Hopkins University, Apple, Google and the CDC. COVID 19 case numbers are relatively inaccurate measurements of the number of infected people as testing has been inconsistent in the US and the federal guidelines for reporting were not established early enough during collection of this data.\n\n::: {#aeff386f .cell execution_count=2}\n``` {.python .cell-code}\ncovid_2020 = pd.read_csv(\"covid_counties_7_2020.csv\", low_memory=False)[['date', 'State', 'County.Name', 'countyFIPS', 'cases', 'deaths', 'population', 'new_cases', 'new_deaths']]\ncovid_2020[100:110].head(5)\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>date</th>\n      <th>State</th>\n      <th>County.Name</th>\n      <th>countyFIPS</th>\n      <th>cases</th>\n      <th>deaths</th>\n      <th>population</th>\n      <th>new_cases</th>\n      <th>new_deaths</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>100</th>\n      <td>2020-05-01</td>\n      <td>Alabama</td>\n      <td>Autauga</td>\n      <td>1001</td>\n      <td>42</td>\n      <td>3.0</td>\n      <td>55869.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>101</th>\n      <td>2020-05-02</td>\n      <td>Alabama</td>\n      <td>Autauga</td>\n      <td>1001</td>\n      <td>45</td>\n      <td>3.0</td>\n      <td>55869.0</td>\n      <td>3.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>102</th>\n      <td>2020-05-03</td>\n      <td>Alabama</td>\n      <td>Autauga</td>\n      <td>1001</td>\n      <td>48</td>\n      <td>3.0</td>\n      <td>55869.0</td>\n      <td>3.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>103</th>\n      <td>2020-05-04</td>\n      <td>Alabama</td>\n      <td>Autauga</td>\n      <td>1001</td>\n      <td>53</td>\n      <td>3.0</td>\n      <td>55869.0</td>\n      <td>5.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>104</th>\n      <td>2020-05-05</td>\n      <td>Alabama</td>\n      <td>Autauga</td>\n      <td>1001</td>\n      <td>53</td>\n      <td>3.0</td>\n      <td>55869.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nWe will study the effects of the virus at the National level and simplify the data a bit more.\n\n::: {#69a08a8b .cell execution_count=3}\n``` {.python .cell-code}\ncovid_usa = covid_2020[['date','cases','deaths','population']].groupby(by=['date']).sum()\ncovid_usa.head(5)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>cases</th>\n      <th>deaths</th>\n      <th>population</th>\n    </tr>\n    <tr>\n      <th>date</th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2020-01-22</th>\n      <td>1</td>\n      <td>0.0</td>\n      <td>328021328.0</td>\n    </tr>\n    <tr>\n      <th>2020-01-23</th>\n      <td>1</td>\n      <td>0.0</td>\n      <td>328021328.0</td>\n    </tr>\n    <tr>\n      <th>2020-01-24</th>\n      <td>2</td>\n      <td>0.0</td>\n      <td>328021328.0</td>\n    </tr>\n    <tr>\n      <th>2020-01-25</th>\n      <td>2</td>\n      <td>0.0</td>\n      <td>328021328.0</td>\n    </tr>\n    <tr>\n      <th>2020-01-26</th>\n      <td>5</td>\n      <td>0.0</td>\n      <td>328021328.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Methods\nA simple mathematical description of the spread of a disease in a population is the so-called SIR model, which divides the (fixed) population of N individuals into three \"compartments\" which may vary as a function of time, t:\n\n* S(t) are those susceptible but not yet infected with the disease\n* I(t) is the number of infectious individuals\n* R(t) are those individuals who have recovered from the disease and now have immunity to it.\n\nThe SIR model describes the change in the population of each of these compartments in terms of two parameters, β and γ. β describes the effective contact rate of the disease: an infected individual comes into contact with β other individuals per unit time (of which the fraction that are susceptible to contracting the disease is S/N). γ is the mean recovery rate: that is, 1/γ is the mean period of time during which an infected individual can pass it on. γ can often be calculated through statistical means, while β can be easily found at the end of the epidemic.\n\nSIR models uses ODE to evaluate the change in infected to recovered cases in a population. The system of ODE is solved for integer time t and the output is a model of each function of SIR with respect to time. It can be shown that the system of ODE is given by the following\n\n$$\\frac{dS}{dt} = - \\beta * I(t) * S(t) / N(t) $$\n$$\\frac{dI}{dt} = \\beta * I(t) * S(t) / N(t) - \\gamma * I(t)$$\n$$\\frac{dR}{dt} = \\gamma * I(t)$$\n\n::: {#eaf17e1c .cell execution_count=4}\n``` {.python .cell-code}\nγ_inverse = 10\nγ = 1/γ_inverse\n\ncovid_usa['recovered_cases'] = covid_usa.shift(periods = γ_inverse)['cases'] # R\ncovid_usa['infected'] = covid_usa['cases'] - covid_usa['recovered_cases'] # I\npopulation = int(covid_usa['population'].mean()) # N\n\ncovid_usa.tail(5)\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>cases</th>\n      <th>deaths</th>\n      <th>population</th>\n      <th>recovered_cases</th>\n      <th>infected</th>\n    </tr>\n    <tr>\n      <th>date</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2020-07-21</th>\n      <td>3871366</td>\n      <td>140654.0</td>\n      <td>328021328.0</td>\n      <td>3572226.0</td>\n      <td>299140.0</td>\n    </tr>\n    <tr>\n      <th>2020-07-22</th>\n      <td>3949024</td>\n      <td>141922.0</td>\n      <td>328021328.0</td>\n      <td>3637066.0</td>\n      <td>311958.0</td>\n    </tr>\n    <tr>\n      <th>2020-07-23</th>\n      <td>4006793</td>\n      <td>142818.0</td>\n      <td>328021328.0</td>\n      <td>3700379.0</td>\n      <td>306414.0</td>\n    </tr>\n    <tr>\n      <th>2020-07-24</th>\n      <td>4080745</td>\n      <td>143960.0</td>\n      <td>328021328.0</td>\n      <td>3778177.0</td>\n      <td>302568.0</td>\n    </tr>\n    <tr>\n      <th>2020-07-25</th>\n      <td>4145882</td>\n      <td>144880.0</td>\n      <td>328021328.0</td>\n      <td>3845894.0</td>\n      <td>299988.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nThe fundamental problem of this model is finding β during the pandemic, of which there is hope in defining c = β/γ = # of close contacts infections a person will have during their contagious period. This can be statistically calculated through contact tracing and testing and can also be found at the end of the pandemic. Unfortunately, this pandemic has proven hard to test and trace accurately, making contact tracing difficult if not impossible to calculate. The approach used in this study for finding parameter β is by fitting the SIR model to historic data using quasi Newtonian optimization methods.\n\nUsing this history based method for calculating β, the parameter γ must also be evaluated. Fortunately, from many resources such as John Hopkins University and now the CDC, 1/γ is estimated as 10 days (meaning an infected person is contagious for 10 days on average). Using this information, COVID 19 case counts can be converted to active (meaning contagious ) case counts by using a sliding window of 1/γ = 10 days. Thus our study requires 70 days of case history to train and model 60 days worth of day. For this, We assume new case counts are the start of the contagious period of 1/γ.\n\n::: {#318072a2 .cell execution_count=5}\n``` {.python .cell-code}\nβ0 = 0.16 # a good starting guess to find β using gradient descent\nwindow = 30\nhistoric = covid_usa.iloc[-(window+2)]\nβ = optimize_fit(β0, population, γ, historic.infected, historic.recovered_cases, covid_usa[-(window+1):-1].infected.values, window)\nprint(f\"β = {β}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nβ = 0.12333714490017725\n```\n:::\n:::\n\n\n## Analysis\n\n::: {#3f2c0fda .cell execution_count=6}\n``` {.python .cell-code}\nforecast_horizon = 500\nsir_model = SIR(β,γ,historic.population)\ns,i,r = sir_model.predict(historic.infected, historic.recovered_cases, forecast_horizon)\n```\n:::\n\n\n::: {#a60ebecc .cell execution_count=7}\n``` {.python .cell-code}\nt = np.arange(np.datetime64(historic.name), np.datetime64(historic.name) + forecast_horizon)\n\nfig = plt.figure(facecolor='w', figsize=(10, 5))\nax = fig.add_subplot(111, facecolor='#dddddd', axisbelow=True)\nax.plot(t, s, 'b', alpha=0.5, lw=2, label='Susceptible')\nax.plot(t, i, 'r', alpha=0.5, lw=2, label='Active Cases')\nax.plot(t, r, 'g', alpha=0.5, lw=2, label='Recovered with immunity')\nax.set_xlabel('Dates')\nax.set_ylabel('Forecasted Values (Millions)')\nax.yaxis.set_tick_params(length=5)\nax.xaxis.set_tick_params(length=5, rotation=20)\n\n# Add descriptions to chart\n#ax.axvline(x=np.datetime64(\"2020-07-20\"), color='gray', linestyle='--', linewidth=2, label=\"Event Date\")\n#ax.text(np.datetime64(\"2020-07-20\"), 10**8, \"Key Event\", color='gray', fontsize=12, ha='right', va='top')\n\nlegend = ax.legend()\nlegend.get_frame().set_alpha(0.5)\nfor spine in ('top', 'right', 'bottom', 'left'):\n    ax.spines[spine].set_visible(False)\nax.set_title(\"COVID Forecast\")\nplt.savefig(\"covid_predictions.png\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-8-output-1.png){}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}